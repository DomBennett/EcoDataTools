EcoDataTools
============

Collection of tools for manipulating ecological data in R.

Example Use
========================================================

Dependent Libraries
-------------------------
First things first, let's bring in the R pacakges that we'll need and the EcodataTools functions:

```{r Libraries, message = FALSE}
library(picante)
library(caper)
library(lme4)
source('EcoDataTools.R')
```

EcoDataTools -- Functions
-------------------------
### Community Phylogeny Functions
#### Test phylogeny
I've saved the Phylocom phylogeny to my working directory. Let's import it and plot it:
```{r Import Phylo}
phylo <- read.tree("Phylocom_phylo.tre")
plot(phylo)
```
Cool beans... now we have a test phylogeny let's see what the functions do.

#### plotComm(comm.data, phylo, groups)
**Description**
Plot the community data alongside the community phylogeny. Every site occupies a column to the left of the phylogeny, for every present species a dot is plotted next to the tip. If the community data represents 2 or more habitat types (e.g. damaged sites and undamaged sites) these can be specified in the *groups* argument. This argument is then used to colour the dots based on habitat type -- each habitat having a disitinctive cut of the colour spectrum (like rainbow()). Abundance data is incorporated into the plot using colour intensity (using the alpha argument in hsv()) -- deepest: highest abundance, lightest: lowest abundance.

**Arguments**
* phylo: the phylogeny to plot alongside
* comm.data: community data to plot
* groups: vector of length nrow(comm.data) specifying the site type

**Code**
```{r plotComm, echo = FALSE}
print(plotComm)
```

**Example Plot**

```{r Hidden Data for plotComm, echo = FALSE}
hidden.data <- read.csv('phylocom_sample.csv', row.names = 1)
plotComm(hidden.data, phylo, groups = rownames(hidden.data))
```

### randCommData(phylo, nsites, nspp, pa = TRUE, lam = 0.1)
**Description**
Generate random community data that has no phylogenetic signal. Can either produce presence/absence data or abundace data using Poisson distribution.

**Arguments**
* phylo: the phylogeny on  which the community will be based
* nsites: number of sites
* nspp: number of species for each site
* pa: presence/absence data?
* lam: lambda for poisson distribution if pa is False

**Code**
```{r randCommData, echo = FALSE}
print(randCommData)
```

**Example Plot**

```{r randCommData - Example, echo = FALSE}
plotComm(randCommData(phylo, 10, 5, pa = F), phylo)
```

### evenCommData(phylo, nsites, nspp)
**Description**
Generate evenly distributed community data. Calculates the cummulative phylogenetic distance from a random tip, finds evenly separate tips based on this cummulative phylogenetic distance. (Depends on split0())

**Arguments**
* phylo: the phylogeny on  which the community will be based
* nsites: number of sites
* nspp: number of species for each site

**Code**
```{r evenCommData, echo = FALSE}
print(evenCommData)
```

**Example Plot**

```{r evenCommData - Example, echo = FALSE}
plotComm(evenCommData(phylo, 10, 5), phylo)
```

### genCommData(phylo, focal, nsites, nspp, fact = 1)
**Description**
Generate clustered/overdispersed community data. Take a phylogeny and determine the probability of a species being present from their phylogenetic distance from the focal tip.

**Arguments**
* phylo: the phylogeny on  which the community will be based
* focal: tip from which clustering/overdisperion occurs
* nsites: number of sites
* nspp: number of species for each site
* fact: negative numbers produce overdisperion from focal, positive numbers produce clustering from focal, and 0 generates random data

**Code**
```{r genCommData, echo = FALSE}
print(genCommData)
```

**How do the probabilities work?**

The co-occurrence of other species in the phylogeny for the idealised phylogenetic distances (1:10) is shown below calcualted with the _genCommData_ function. On the left clustering, on the right overdispersion. 

```{r genCommData Probs, echo = FALSE}
par(mar = c(5, 4, 4, 2), mfrow = c(1,2))
for (i in 1:2) {
  clust <- ifelse(i == 1, TRUE, FALSE)
  title <- ifelse(i ==1, '\'Clusteredness\'', '\'Overdispersed\'')
  focal.dists <- seq(1,10,1)
  fact <- c(0, 0.5,1,2,3)
  cols <- rainbow(length(fact), alpha = 0.9)
  plot(seq.int(0, 0.4, length.out = length(focal.dists)) ~ focal.dists,
       type = 'n', xlab = "Phylogenetic Distance from Focal",
       ylab = "P(Co-occurence)")
  for (j in 1:length(fact)) {
    temp.dists <- sort(focal.dists, decreasing = clust)
    probs <- temp.dists^fact[j]
    probs <- probs/sum(probs)
    lines(probs ~ focal.dists, col = cols[j], lwd = 2)
  }
  legend("topright", legend = fact, col = cols, pch = 19,
         title = title)
}
```

**Example use**
* Create 5 different types of habitat setting tip 16 as focal.
* Types 1 and 2 will produce clustered data with fact 1 and 10
* Type 3 is random
* Type 4 and 5 will produce overdispersed data with fact -1 and -10
* Row bind into a single dataframe called _all_
* Create _types_, a vector to identify the rows in _all_ for plotComm()
* Plot with plotComm()

```{r genCommData - Example Use}
type1 <- genCommData(phylo, focal = 16, nsites = 10, nspp = 5, fact = 1)
type2 <- genCommData(phylo, focal = 16, nsites = 10, nspp = 5, fact = 10)
type3 <- genCommData(phylo, focal = 16, nsites = 10, nspp = 5, fact = 0)
type4 <- genCommData(phylo, focal = 16, nsites = 10, nspp = 5, fact = -1)
type5 <- genCommData(phylo, focal = 16, nsites = 10, nspp = 5, fact = -10)
all <- rbind(type1, type2, type3, type4, type5)
types <- paste0('t', rep(1:5, each = 10))
plotComm(all, phylo, groups = types)
```